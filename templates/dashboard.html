<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Hub - ZeroWaste.AI</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Plotly.js CDN -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'green-primary': '#059669',
                        'green-secondary': '#047857',
                        'green-light': '#d1fae5',
                        'green-dark': '#064e3b',
                        'accent-blue': '#0ea5e9',
                        'accent-purple': '#8b5cf6',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out',
                        'slide-up': 'slideUp 0.8s ease-out',
                        'slide-in-left': 'slideInLeft 0.6s ease-out',
                        'slide-in-right': 'slideInRight 0.6s ease-out',
                        'bounce-gentle': 'bounceGentle 2s ease-in-out infinite',
                        'pulse-ring': 'pulseRing 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite',
                        'count-up': 'countUp 2s ease-out',
                        'scale-in': 'scaleIn 0.5s ease-out',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(40px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideInLeft: {
                            '0%': { opacity: '0', transform: 'translateX(-40px)' },
                            '100%': { opacity: '1', transform: 'translateX(0)' }
                        },
                        slideInRight: {
                            '0%': { opacity: '0', transform: 'translateX(40px)' },
                            '100%': { opacity: '1', transform: 'translateX(0)' }
                        },
                        bounceGentle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        pulseRing: {
                            '0%': { transform: 'scale(0.33)' },
                            '80%, 100%': { transform: 'scale(1)', opacity: '0' }
                        },
                        countUp: {
                            '0%': { transform: 'scale(0.5)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #059669;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .glass-nav {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .metric-card {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 35px 60px -12px rgba(0, 0, 0, 0.3);
        }
        
        .table-modern {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .chart-container {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f0f9ff 100%);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-modern {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-modern:hover::before {
            left: 100%;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #059669, #0ea5e9);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: 200px 0; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Enhanced Navigation -->
    <nav class="glass-nav sticky top-0 z-50 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo/Title -->
                <div class="flex items-center animate-slide-in-left">
                    <h1 class="text-xl font-bold bg-gradient-to-r from-green-primary to-accent-blue bg-clip-text text-transparent">
                        ZeroWaste.AI
                    </h1>
                    <span class="ml-2 text-sm text-gray-600 hidden sm:inline">Analytics Hub</span>
                </div>
                
                <!-- Navigation Links -->
                <div class="hidden md:flex items-center space-x-6 animate-fade-in">
                    <a href="{{ url_for('dashboard') }}" 
                       class="text-green-primary bg-green-primary/10 px-3 py-2 rounded-lg text-sm font-medium">
                        Dashboard
                    </a>
                    <a href="{{ url_for('inventory') }}" 
                       class="text-gray-700 hover:text-green-primary px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300 hover:bg-green-primary/10">
                        Inventory Check
                    </a>
                </div>
                
                <!-- User Menu -->
                <div class="flex items-center space-x-4 animate-slide-in-right">
                    <div class="hidden sm:flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-r from-green-primary to-accent-blue rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-semibold">D</span>
                        </div>
                        <span class="text-sm text-gray-700">Demo User</span>
                    </div>
                    <a href="{{ url_for('login') }}" 
                       class="text-red-600 hover:text-red-800 text-sm font-medium transition-colors duration-300 hover:bg-red-50 px-3 py-1 rounded-lg">
                        Log Out
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Mobile Navigation -->
        <div class="md:hidden border-t border-gray-200">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="{{ url_for('dashboard') }}" 
                   class="block px-3 py-2 text-green-primary bg-green-primary/10 rounded-md text-base font-medium">
                    Dashboard
                </a>
                <a href="{{ url_for('inventory') }}" 
                   class="block px-3 py-2 text-gray-700 hover:text-green-primary rounded-md text-base font-medium">
                    Inventory Check
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="pt-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Enhanced Page Header -->
            <div class="text-center mb-12 animate-fade-in">
                <h1 class="text-4xl font-bold bg-gradient-to-r from-green-primary via-accent-blue to-accent-purple bg-clip-text text-transparent mb-4">
                    Analytics Dashboard
                </h1>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                    Real-time insights into your sustainability impact and waste reduction performance
                </p>
                <div class="w-24 h-1 bg-gradient-to-r from-green-primary to-accent-blue mx-auto mt-6 rounded-full"></div>
            </div>
            
            <!-- Enhanced Metrics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                <!-- Total Units Saved -->
                <div class="metric-card rounded-2xl p-8 animate-slide-up" style="animation-delay: 0.1s;">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-gradient-to-r from-green-primary to-green-secondary rounded-xl flex items-center justify-center mr-4">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Total Units Saved</p>
                                    <p class="text-3xl font-bold text-gray-900 count-up" data-target="{{ metrics.saved_units }}">0</p>
                                </div>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="progress-bar h-2 rounded-full" {% if metrics.saved_units < 100 %}style="width: {{ (metrics.saved_units/100)*100 }}%"{% else %}style="width: 100%"{% endif %}></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Updated in real-time</p>
                        </div>
                    </div>
                </div>
                
                <!-- CO₂ Prevented -->
                <div class="metric-card rounded-2xl p-8 animate-slide-up" style="animation-delay: 0.2s;">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-gradient-to-r from-accent-blue to-blue-600 rounded-xl flex items-center justify-center mr-4">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-600">CO₂ Prevented</p>
                                    <p class="text-3xl font-bold text-gray-900 count-up" data-target="{{ metrics.co2_saved }}">0</p>
                                    <span class="text-sm text-gray-500">kg</span>
                                </div>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="progress-bar h-2 rounded-full" {% if metrics.co2_saved < 10 %}style="width: {{ (metrics.co2_saved/10)*100 }}%"{% else %}style="width: 100%"{% endif %}></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Updated in real-time</p>
                        </div>
                    </div>
                </div>
                
                <!-- Green Score -->
                <div class="metric-card rounded-2xl p-8 animate-slide-up" style="animation-delay: 0.3s;">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-gradient-to-r from-accent-purple to-purple-600 rounded-xl flex items-center justify-center mr-4">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Green Score Rank</p>
                                    <p class="text-3xl font-bold text-gray-900 count-up" data-target="{{ (metrics.saved_units * 50 + metrics.co2_saved * 50) | round | int }}">0</p>
                                    <span class="text-sm text-gray-500">/100</span>
                                </div>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="progress-bar h-2 rounded-full" style="width: {{ ((metrics.saved_units * 50 + metrics.co2_saved * 50) | round | int) }}%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Based on units saved and CO₂ prevented</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced High-Risk Items Table -->
            <div class="table-modern rounded-2xl mb-12 animate-slide-up" style="animation-delay: 0.4s;">
                <div class="px-8 py-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 flex items-center">
                                <div class="w-8 h-8 bg-gradient-to-r from-red-500 to-orange-500 rounded-lg flex items-center justify-center mr-3">
                                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                </div>
                                High-Risk Items
                            </h2>
                            <p class="text-gray-600 mt-1">Products requiring immediate attention</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                {{ items|length }} items at risk
                            </span>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead class="bg-gray-50/50">
                            <tr>
                                <th class="px-8 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Product</th>
                                <th class="px-8 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Days on Shelf</th>
                                <th class="px-8 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Freshness Score</th>
                                <th class="px-8 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Action</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            {% for item in items %}
                            <tr class="hover:bg-gray-50/50 transition-colors duration-200">
                                <td class="px-8 py-6 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="text-2xl mr-3">{{ item.emoji }}</div>
                                        <div>
                                            <div class="text-sm font-semibold text-gray-900">{{ item.product }}</div>
                                            <div class="text-xs text-gray-500">{{ item.category }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-8 py-6 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="text-sm text-gray-900 font-medium">{{ item.days_old }} days</div>
                                        <div class="ml-2 w-2 h-2 {% if item.freshness < 50 %}bg-red-400{% else %}bg-yellow-400{% endif %} rounded-full animate-pulse"></div>
                                    </div>
                                </td>
                                <td class="px-8 py-6 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-16 bg-gray-200 rounded-full h-2 mr-3">
                                            {% if item.freshness < 50 %}
                                            <div class="bg-red-500 h-2 rounded-full" style="width: {{ item.freshness }}%"></div>
                                            {% else %}
                                            <div class="bg-yellow-500 h-2 rounded-full" style="width: {{ item.freshness }}%"></div>
                                            {% endif %}
                                        </div>
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold {% if item.freshness < 50 %}bg-red-100 text-red-800{% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                            {{ item.freshness }}%
                                        </div>
                                    </div>
                                </td>
                                <td class="px-8 py-6 whitespace-nowrap">
                                    <button onclick="openRedistributeModal('{{ item.product }}', '{{ item.location }}', {{ item.freshness }})" 
                                            class="btn-modern inline-flex items-center px-4 py-2 border border-transparent text-xs font-semibold rounded-xl text-white bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transform hover:scale-105 transition-all duration-300">
                                        🚚 Redistribute
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Enhanced Map & Chart Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Redistribution Map -->
                <div class="chart-container rounded-2xl animate-slide-in-left" style="animation-delay: 0.5s;">
                    <div class="px-8 py-6 border-b border-gray-200">
                        <h2 class="text-xl font-bold text-gray-900 flex items-center">
                            <div class="w-8 h-8 bg-gradient-to-r from-green-primary to-accent-blue rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                                </svg>
                            </div>
                            Redistribution Routes
                        </h2>
                        <p class="text-gray-600 mt-1">Live tracking of food redistribution network</p>
                    </div>
                    <div class="p-8">
                        <div id="redistribution-map" class="h-80 rounded-xl overflow-hidden"></div>
                    </div>
                </div>
                
                <!-- CO₂ Savings Chart -->
                <div class="chart-container rounded-2xl animate-slide-in-right" style="animation-delay: 0.6s;">
                    <div class="px-8 py-6 border-b border-gray-200">
                        <h2 class="text-xl font-bold text-gray-900 flex items-center">
                            <div class="w-8 h-8 bg-gradient-to-r from-accent-blue to-accent-purple rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                            </div>
                            Environmental Impact
                        </h2>
                        <p class="text-gray-600 mt-1">CO₂ savings per redistribution route</p>
                    </div>
                    <div class="p-8">
                        <div id="co2-chart" class="h-80"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Enhanced Redistribution Modal -->
    <div id="redistribute-modal" class="fixed inset-0 modal-backdrop overflow-y-auto h-full w-full hidden z-50 animate-fade-in" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-96 shadow-2xl rounded-2xl modal-content animate-scale-in">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900 flex items-center" id="modal-title">
                    <div class="w-8 h-8 bg-gradient-to-r from-orange-500 to-red-500 rounded-lg flex items-center justify-center mr-3">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                        </svg>
                    </div>
                    Redistribute Product
                </h3>
                <button onclick="closeRedistributeModal()" 
                        class="text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300 rounded-lg p-2 transition-colors duration-200"
                        aria-label="Close modal">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Content -->
            <div class="mb-8">
                <p class="text-gray-600 mb-6">
                    Select the optimal redistribution outlet for <span id="modal-product-name" class="font-semibold text-gray-900">this product</span>:
                </p>
                
                <!-- Enhanced Outlet Options -->
                <div class="space-y-4">
                    <label class="flex items-start p-4 border-2 border-gray-200 rounded-xl hover:border-green-primary hover:bg-green-50 cursor-pointer transition-all duration-300 group">
                        <input type="radio" 
                               name="redistribution_outlet" 
                               value="Food Bank Central" 
                               checked
                               class="mt-1 h-5 w-5 text-green-primary focus:ring-green-primary border-gray-300">
                        <div class="ml-4 flex-1">
                            <div class="flex items-center justify-between">
                                <div class="font-semibold text-gray-900 group-hover:text-green-primary transition-colors">Food Bank Central</div>
                                <div class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Recommended</div>
                            </div>
                            <div class="text-sm text-gray-600 mt-1 flex items-center space-x-4">
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    2.3 km
                                </span>
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                                    </svg>
                                    500 kg capacity
                                </span>
                            </div>
                        </div>
                    </label>
                    
                    <label class="flex items-start p-4 border-2 border-gray-200 rounded-xl hover:border-green-primary hover:bg-green-50 cursor-pointer transition-all duration-300 group">
                        <input type="radio" 
                               name="redistribution_outlet" 
                               value="Community Kitchen"
                               class="mt-1 h-5 w-5 text-green-primary focus:ring-green-primary border-gray-300">
                        <div class="ml-4 flex-1">
                            <div class="font-semibold text-gray-900 group-hover:text-green-primary transition-colors">Community Kitchen</div>
                            <div class="text-sm text-gray-600 mt-1 flex items-center space-x-4">
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    4.1 km
                                </span>
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                                    </svg>
                                    300 kg capacity
                                </span>
                            </div>
                        </div>
                    </label>
                    
                    <label class="flex items-start p-4 border-2 border-gray-200 rounded-xl hover:border-green-primary hover:bg-green-50 cursor-pointer transition-all duration-300 group">
                        <input type="radio" 
                               name="redistribution_outlet" 
                               value="Shelter Home"
                               class="mt-1 h-5 w-5 text-green-primary focus:ring-green-primary border-gray-300">
                        <div class="ml-4 flex-1">
                            <div class="font-semibold text-gray-900 group-hover:text-green-primary transition-colors">Shelter Home</div>
                            <div class="text-sm text-gray-600 mt-1 flex items-center space-x-4">
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    6.8 km
                                </span>
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                                    </svg>
                                    200 kg capacity
                                </span>
                            </div>
                        </div>
                    </label>
                </div>
            </div>
            
            <!-- Modal Actions -->
            <div class="flex flex-col sm:flex-row gap-4">
                <button onclick="closeRedistributeModal()" 
                        class="flex-1 px-6 py-3 text-sm font-semibold text-gray-700 bg-gray-100 border border-gray-300 rounded-xl hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-300">
                    Cancel
                </button>
                <button onclick="confirmRedistribution()" 
                        id="confirm-redistribute-btn"
                        class="btn-modern flex-1 px-6 py-3 text-sm font-semibold text-white bg-gradient-to-r from-green-primary to-green-secondary border border-transparent rounded-xl hover:from-green-secondary hover:to-green-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-primary transform hover:scale-105 transition-all duration-300">
                    <span id="confirm-btn-text">🚀 Confirm Redistribution</span>
                    <div id="confirm-btn-spinner" class="spinner ml-2 hidden"></div>
                </button>
            </div>
            
            <!-- Success Message -->
            <div id="redistribution-success" class="hidden mt-6 p-4 bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 text-green-700 rounded-xl animate-slide-up">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <div>
                        <div class="font-semibold">Success!</div>
                        <span id="success-message" class="text-sm">Redistribution scheduled successfully!</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Dashboard JavaScript for ZeroWaste.AI
        document.addEventListener("DOMContentLoaded", () => {
            initializeAnimations()
            initializeCharts()
        })

        // Global variables for modal and metrics
        let currentProduct = "";
        let currentLocation = "";
        let currentFreshness = 0;
        let metricsData = {
            saved_units: 0,
            co2_saved: 0
        };

        // Initialize animations
        function initializeAnimations() {
            // Animate counter numbers
            const counters = document.querySelectorAll('.count-up')
            counters.forEach(counter => {
                const target = parseInt(counter.getAttribute('data-target'))
                let current = 0
                const increment = target / 100
                const timer = setInterval(() => {
                    current += increment
                    if (current >= target) {
                        current = target
                        clearInterval(timer)
                    }
                    if (target > 100) {
                        counter.textContent = Math.floor(current).toLocaleString()
                    } else {
                        counter.textContent = current.toFixed(1)
                    }
                }, 20)
            })
        }

        // Initialize Plotly charts
        function initializeCharts() {
            if (typeof Plotly === "undefined") {
                console.error("Plotly.js is not loaded")
                return
            }

            createRedistributionMap()
            createCO2Chart()
        }

        // Create enhanced redistribution map
        function createRedistributionMap() {
            const mapData = [
                {
                    type: "scattermapbox",
                    lat: [28.6139, 19.076, 12.9716, 22.5726, 13.0827],
                    lon: [77.209, 72.8777, 77.5946, 88.3639, 80.2707],
                    mode: "markers+lines",
                    marker: {
                        size: [20, 16, 14, 12, 10],
                        color: ["#059669", "#0ea5e9", "#8b5cf6", "#f59e0b", "#ef4444"],
                        sizemode: "diameter",
                        line: {
                            width: 2,
                            color: "#ffffff"
                        }
                    },
                    line: {
                        width: 4,
                        color: "#059669",
                    },
                    text: ["Delhi (Origin)", "Mumbai Hub", "Bangalore Center", "Kolkata Point", "Chennai Station"],
                    textposition: "top center",
                    textfont: {
                        size: 12,
                        color: "#374151"
                    },
                    hovertemplate: "<b>%{text}</b><br>Lat: %{lat}<br>Lon: %{lon}<br>Status: Active<extra></extra>",
                },
            ]

            const mapLayout = {
                mapbox: {
                    style: "open-street-map",
                    center: { lat: 20.5937, lon: 78.9629 },
                    zoom: 4.5,
                },
                margin: { r: 0, t: 0, l: 0, b: 0 },
                showlegend: false,
                height: 320,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            }

            const config = {
                responsive: true,
                displayModeBar: false,
            }

            try {
                Plotly.newPlot("redistribution-map", mapData, mapLayout, config)
            } catch (error) {
                console.error("Error creating map:", error)
                document.getElementById("redistribution-map").innerHTML =
                    '<div class="flex items-center justify-center h-full text-gray-500"><div class="text-center"><div class="text-4xl mb-2">🗺️</div><div>Map loading failed</div></div></div>'
            }
        }

        // Create enhanced CO₂ savings chart
        function createCO2Chart() {
            const chartData = [
                {
                    x: ["Delhi → Mumbai", "Delhi → Bangalore", "Delhi → Kolkata", "Delhi → Chennai"],
                    y: [0.8, 1.2, 0.6, 1.4],
                    type: "bar",
                    marker: {
                        color: ["#059669", "#0ea5e9", "#8b5cf6", "#f59e0b"],
                        line: {
                            color: "#ffffff",
                            width: 2,
                        },
                        opacity: 0.8
                    },
                    hovertemplate: "<b>%{x}</b><br>CO₂ Saved: %{y} tons<br>Impact: High<extra></extra>",
                },
            ]

            const chartLayout = {
                title: {
                    text: "",
                    font: { size: 16, color: "#374151" },
                },
                xaxis: {
                    title: {
                        text: "Redistribution Routes",
                        font: { size: 12, color: "#6b7280" }
                    },
                    tickangle: -45,
                    tickfont: { size: 10, color: "#6b7280" }
                },
                yaxis: {
                    title: {
                        text: "CO₂ Saved (tons)",
                        font: { size: 12, color: "#6b7280" }
                    },
                    tickfont: { size: 10, color: "#6b7280" }
                },
                margin: { l: 60, r: 20, t: 20, b: 80 },
                height: 320,
                plot_bgcolor: "rgba(0,0,0,0)",
                paper_bgcolor: "rgba(0,0,0,0)",
                font: { family: "Inter, system-ui, sans-serif" }
            }

            const config = {
                responsive: true,
                displayModeBar: false,
            }

            try {
                Plotly.newPlot("co2-chart", chartData, chartLayout, config)
            } catch (error) {
                console.error("Error creating chart:", error)
                document.getElementById("co2-chart").innerHTML =
                    '<div class="flex items-center justify-center h-full text-gray-500"><div class="text-center"><div class="text-4xl mb-2">📊</div><div>Chart loading failed</div></div></div>'
            }
        }

        // Enhanced modal functions
        function openRedistributeModal(productName, location, freshness) {
            currentProduct = productName;
            currentLocation = location;
            currentFreshness = freshness;
            
            document.getElementById("modal-product-name").textContent = productName;
            const modal = document.getElementById("redistribute-modal");
            modal.classList.remove("hidden");
        }

        function closeRedistributeModal() {
            const modal = document.getElementById("redistribute-modal");
            modal.classList.add("hidden");
            
            // Reset form state
            document.getElementById("redistribution-success").classList.add("hidden");
            document.getElementById("confirm-btn-spinner").classList.add("hidden");
            document.getElementById("confirm-btn-text").textContent = "🚀 Confirm Redistribution";
            document.getElementById("confirm-redistribute-btn").disabled = false;
        }

        function updateMetrics(newMetrics) {
            metricsData = newMetrics;
            
            // Update counters
            document.querySelectorAll('.count-up').forEach(counter => {
                const target = counter.getAttribute('data-target');
                counter.setAttribute('data-target', newMetrics[target] || 0);
                
                // Trigger animation
                let current = 0;
                const increment = newMetrics[target] / 100;
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= newMetrics[target]) {
                        current = newMetrics[target];
                        clearInterval(timer);
                    }
                    if (newMetrics[target] > 100) {
                        counter.textContent = Math.floor(current).toLocaleString();
                    } else {
                        counter.textContent = current.toFixed(1);
                    }
                }, 20);
            });

            // Update progress bars
            const savedUnitsBar = document.querySelector('.metric-card:nth-child(1) .progress-bar');
            const co2Bar = document.querySelector('.metric-card:nth-child(2) .progress-bar');
            const scoreBar = document.querySelector('.metric-card:nth-child(3) .progress-bar');
            
            savedUnitsBar.style.width = `${Math.min(newMetrics.saved_units, 100)}%`;
            co2Bar.style.width = `${Math.min((newMetrics.co2_saved/10)*100, 100)}%`;
            scoreBar.style.width = `${Math.min(newMetrics.saved_units * 50 + newMetrics.co2_saved * 50, 100)}%`;
        }

        function confirmRedistribution() {
            const btn = document.getElementById("confirm-redistribute-btn");
            const btnText = document.getElementById("confirm-btn-text");
            const spinner = document.getElementById("confirm-btn-spinner");
            
            // Disable button and show spinner
            btn.disabled = true;
            btnText.textContent = "Processing...";
            spinner.classList.remove("hidden");
            
            // Get selected outlet
            const selectedOutlet = document.querySelector('input[name="redistribution_outlet"]:checked').value;
            
            // Prepare data
            const data = {
                product: currentProduct,
                location: currentLocation,
                freshness: currentFreshness,
                outlet: selectedOutlet
            };
            
            // Send AJAX request
            fetch('/redistribute', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {            // Update metrics
            updateMetrics(data.metrics);
            
            // Remove the redistributed item row from the table
            const itemRows = document.querySelectorAll('tr');
            itemRows.forEach(row => {
                const productCell = row.querySelector('td:first-child');
                if (productCell && productCell.textContent.includes(currentProduct)) {
                    row.remove();
                }
            });
            
            // Update the count of items at risk
            const countElement = document.querySelector('.bg-red-100.text-red-800');
            const currentCount = parseInt(countElement.textContent);
            countElement.textContent = `${currentCount - 1} items at risk`;
            
            // Show success message
            document.getElementById("redistribution-success").classList.remove("hidden");
            document.getElementById("success-message").textContent = 
                `Successfully redistributed ${currentProduct} to ${selectedOutlet}`;
            
            // Update button state
            btnText.textContent = "✅ Redistributed";
            spinner.classList.add("hidden");
            
            // Close modal after delay
            setTimeout(() => {
                closeRedistributeModal();
            }, 2000);
            })
            .catch(error => {
                console.error('Error:', error);
                btnText.textContent = "❌ Error";
                spinner.classList.add("hidden");
                btn.disabled = false;
            });
        }

        // Enhanced event listeners
        document.addEventListener("click", (e) => {
            const modal = document.getElementById("redistribute-modal")
            if (e.target === modal) {
                closeRedistributeModal()
            }
        })

        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") {
                closeRedistributeModal()
            }
        })

        // Enhanced chart resize handling
        window.addEventListener("resize", () => {
            if (typeof Plotly !== "undefined") {
                setTimeout(() => {
                    Plotly.Plots.resize("redistribution-map")
                    Plotly.Plots.resize("co2-chart")
                }, 100)
            }
        })

        // Add intersection observer for scroll animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        }

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-fade-in')
                }
            })
        }, observerOptions)

        // Observe elements for scroll animations
        document.querySelectorAll('.metric-card, .table-modern, .chart-container').forEach(el => {
            observer.observe(el)
        })
    </script>
</body>
</html>
